
只有一个实例

## 资料
[Kotlin下的5种单例模式](https://juejin.im/post/5acf49a06fb9a028d700ff4d)
[[译]Object的局限性——Kotlin中的带参单例模式](https://www.jianshu.com/p/2d0f285f6e4b)


## 饿汉式
饿汉式是由the singleton instance is early created at compile time中的early音译过来的。编译期实例化对象

Java：
```
public class JavaEarlySingleton {

    private static JavaEarlySingleton instance = new JavaEarlySingleton();

    private JavaEarlySingleton() {
    }

    public static JavaEarlySingleton getInstance() {
        return instance;
    }
    
}
```

kotlin：
```
object EarlySingleton
```
转字节码：
```
public final class EarlySingleton {
   public static final EarlySingleton INSTANCE;

   private EarlySingleton() {
   }

   static {
      EarlySingleton var0 = new EarlySingleton();
      INSTANCE = var0;
   }
}
```

## 懒汉式
懒汉式是由the singleton instance is lazily created at runtime中的lazily意译过来的。运行时实例化对象

Java：
```
public class JavaLazilySingleton {

    private static JavaLazilySingleton instance;

    private JavaLazilySingleton() {
    }

    public static JavaLazilySingleton getInstance() {
        if (null == instance) {
            instance = new JavaLazilySingleton();
        }
        return instance;
    }

}
```

kotlin:
```
class LazilySingleton {

    companion object {
        private var instance: LazilySingleton? = null
            get() {
                if (null == field) {
                    field = LazilySingleton()
                }
                return field
            }

        fun get(): LazilySingleton {
            return instance!!
        }
    }
}
```

## 饿汉式和懒汉式线程安全问题
```
/**
 * 饿汉式单例线程安全
 */
fun testEarly() {
    val executorService = Executors.newFixedThreadPool(20)
    for (i in 0..20) {
        executorService.execute {
            println(Thread.currentThread().name + ": " + EarlySingleton)
        }
    }
    executorService.shutdown()
}

/**
 * 懒汉式单例线程不安全
 */
fun testLazily() {
    val executorService = Executors.newFixedThreadPool(20)
    for (i in 0..20) {
        executorService.execute {
            println(Thread.currentThread().name + ": " + LazilySingleton.get())
        }
    }
    executorService.shutdown()
}
```
