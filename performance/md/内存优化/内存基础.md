


## 内存
Java把内存划分成两种：一种是栈内存，一种是堆内存。


## 栈内存
存放基本类型的变量，对象的引用和方法调用，遵循先入后出的规则


## 堆内存
存放所有new出来的对象



## 查看单个应用的初始内存
```
adb shell
getprop | grep dalvik.vm.heapstartsize
```
```
root@vbox86p:/ # getprop | grep dalvik.vm.heapstartsize
[dalvik.vm.heapstartsize]: [8m]
```

## 查看单个应用最大可用内存
```
adb shell
getprop | grep dalvik.vm.heapgrowthlimit
```
```
root@vbox86p:/ # getprop | grep dalvik.vm.heapgrowthlimit
[dalvik.vm.heapgrowthlimit]: [96m]
```

不同设备给每个app分配的内存都可能不一样。如果超过单个应用最大可用内存则会出现OOM，如果设置了开启largeHeap, 则可提高到dvm最大内存才OOM。
```
    <application
        ...
        android:largeHeap="true">
```

## 查看dvm最大可用内存
```
adb shell
getprop | grep dalvik.vm.heapsize
```
```
root@vbox86p:/ # getprop | grep dalvik.vm.heapsize
[dalvik.vm.heapsize]: [256m]
```

## 查看 build.prop 文件
应用内存的属性值都定义在/system/build.prop文件中的
```
adb shell 
cat /system/build.prop
```

## 查看指定app内存使用情况
```
adb shell
dumpsys meminfo com.mackwu.performance
```
- HeapSize（堆总大小）
- HeapAlloc（已用大小）
- HeapFree（剩余可用）
```
                   Pss  Private  Private  Swapped     Heap     Heap     Heap
                 Total    Dirty    Clean    Dirty     Size    Alloc     Free
                ------   ------   ------   ------   ------   ------   ------
  Native Heap     3263     2536        0        0    26368    24938     1429
  Dalvik Heap     1231     1180        0        0     2254     1138     1116
 Dalvik Other      433      432        0        0
        Stack      120      120        0        0
       Ashmem        4        4        0        0
    Other dev        4        0        4        0
     .so mmap     1903      124      144        0
    .apk mmap      677        0       32        0
    .ttf mmap       47        0        0        0
    .dex mmap     5788        4     5784        0
    .oat mmap     2420        0       68        0
    .art mmap     1001      480        0        0
   Other mmap       13        8        0        0
      Unknown      117      116        0        0
        TOTAL    17021     5004     6032        0    28622    26076     2545
```